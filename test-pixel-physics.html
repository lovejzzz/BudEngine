<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Physics v3.5 - Performance & Integration - Bud Engine</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #0a0a14;
            font-family: 'Courier New', monospace;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        h1 {
            margin: 0;
            font-size: 28px;
            text-align: center;
            color: #00ffcc;
            text-shadow: 0 0 10px #00ffcc;
        }
        
        .subtitle {
            margin: 0;
            font-size: 16px;
            color: #ff8800;
            text-align: center;
            text-shadow: 0 0 8px #ff8800;
        }
        
        .philosophy {
            max-width: 700px;
            text-align: center;
            font-size: 13px;
            color: #888;
            border: 1px solid #333;
            padding: 10px;
            background: #1a1a2e;
            margin-bottom: 10px;
        }
        
        .philosophy strong {
            color: #00ffcc;
        }
        
        #gameCanvas {
            border: 2px solid #00ffcc;
            box-shadow: 0 0 20px rgba(0, 255, 204, 0.3);
            cursor: crosshair;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 900px;
        }
        
        .control-section {
            background: #16162e;
            border: 1px solid #333;
            padding: 8px;
            border-radius: 3px;
        }
        
        .control-section h3 {
            margin: 0 0 8px 0;
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
        }
        
        .material-btn {
            padding: 8px 14px;
            background: #1a1a2e;
            border: 2px solid #444;
            color: #fff;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            transition: all 0.2s;
            position: relative;
        }
        
        .material-btn:hover {
            border-color: #00ffcc;
            box-shadow: 0 0 10px rgba(0, 255, 204, 0.3);
        }
        
        .material-btn.active {
            background: #00ffcc;
            color: #0a0a14;
            border-color: #00ffcc;
            box-shadow: 0 0 20px rgba(0, 255, 204, 0.5);
            font-weight: bold;
        }
        
        .material-btn::before {
            content: '';
            display: inline-block;
            width: 10px;
            height: 10px;
            margin-right: 6px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        /* Material colors */
        .material-btn[data-material="sand"]::before { background: #c2b280; }
        .material-btn[data-material="water"]::before { background: #1a6bff; }
        .material-btn[data-material="ice"]::before { background: #a0d0ff; }
        .material-btn[data-material="steam"]::before { background: #e0e0e0; }
        .material-btn[data-material="fire"]::before { background: #ff4400; }
        .material-btn[data-material="wood"]::before { background: #8b4513; }
        .material-btn[data-material="coal"]::before { background: #1a1a1a; }
        .material-btn[data-material="oil"]::before { background: #1a1a1a; }
        .material-btn[data-material="stone"]::before { background: #4a4a4a; }
        .material-btn[data-material="lava"]::before { background: #ff4400; }
        .material-btn[data-material="obsidian"]::before { background: #0f0f0f; }
        .material-btn[data-material="glass"]::before { background: #88ccff; opacity: 0.5; }
        .material-btn[data-material="dirt"]::before { background: #654321; }
        .material-btn[data-material="mud"]::before { background: #4a3520; }
        .material-btn[data-material="clay"]::before { background: #a07855; }
        .material-btn[data-material="iron"]::before { background: #888888; }
        .material-btn[data-material="smoke"]::before { background: #3a3a3a; }
        .material-btn[data-material="oxygen"]::before { background: #ccffff; opacity: 0.4; }
        .material-btn[data-material="hydrogen"]::before { background: #ffcccc; opacity: 0.4; }
        .material-btn[data-material="methane"]::before { background: #cceecc; opacity: 0.4; }
        .material-btn[data-material="co2"]::before { background: #e0e0e0; opacity: 0.4; }
        .material-btn[data-material="acid"]::before { background: #88ff44; opacity: 0.7; }
        .material-btn[data-material="salt"]::before { background: #f0f0f0; }
        .material-btn[data-material="sulfur"]::before { background: #ffff00; }
        .material-btn[data-material="gunpowder"]::before { background: #2a2a2a; }
        
        .action-btn {
            padding: 10px 20px;
            background: #ff4400;
            border: 2px solid #ff6600;
            color: #fff;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            background: #ff6600;
            box-shadow: 0 0 20px rgba(255, 68, 0, 0.5);
        }
        
        .action-btn.secondary {
            background: #333;
            border-color: #555;
        }
        
        .action-btn.secondary:hover {
            background: #555;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
        }
        
        .action-btn.heat {
            background: #ff8800;
            border-color: #ffaa00;
        }
        
        .action-btn.heat:hover {
            background: #ffaa00;
        }
        
        .info {
            text-align: center;
            font-size: 11px;
            color: #666;
            max-width: 700px;
            line-height: 1.5;
        }
        
        .info strong {
            color: #00ffcc;
        }
        
        .info .temp {
            color: #ff8800;
        }
        
        .brush-size {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: #1a1a2e;
            border: 2px solid #444;
        }
        
        .brush-size label {
            font-size: 12px;
        }
        
        .brush-size input {
            width: 80px;
        }
        
        .stats {
            font-size: 11px;
            color: #888;
            text-align: center;
        }
        
        .temp-display {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(26, 26, 46, 0.95);
            border: 2px solid #ff8800;
            padding: 12px 18px;
            font-size: 16px;
            color: #ff8800;
            text-shadow: 0 0 10px #ff8800;
            display: none;
            border-radius: 3px;
        }
        
        .temp-display.active {
            display: block;
        }
        
        .scenario-btn {
            padding: 8px 16px;
            background: #2a2a4e;
            border: 2px solid #5555ff;
            color: #aaaaff;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .scenario-btn:hover {
            background: #3a3a6e;
            border-color: #7777ff;
            color: #ccccff;
        }
    </style>
</head>
<body>
    <h1>‚öõÔ∏è Emergent Pixel Physics v3.5 ‚öõÔ∏è</h1>
    <p class="subtitle">‚ö° Performance Optimized + Entity Integration üéÆ</p>
    
    <div class="philosophy">
        <strong>PHILOSOPHY:</strong> No hardcoded interactions. Materials have real physical properties.
        Interactions EMERGE from those properties meeting conditions. This is how we build Earth.
    </div>
    
    <!-- Audio Enable Overlay -->
    <div id="audioOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(10,10,20,0.95); z-index:9999; display:flex; align-items:center; justify-content:center; flex-direction:column; cursor:pointer;">
        <div style="text-align:center; color:#00ffcc; font-size:24px; text-shadow: 0 0 20px #00ffcc;">
            <div style="font-size:48px; margin-bottom:20px;">üîä</div>
            <div style="margin-bottom:10px;">Click to Enable Audio</div>
            <div style="font-size:14px; color:#888;">Web Audio requires user interaction</div>
        </div>
    </div>
    
    <canvas id="gameCanvas"></canvas>
    
    <div class="temp-display" id="tempDisplay">
        üå°Ô∏è <span id="tempValue">20</span>¬∞C
    </div>
    
    <div class="control-section">
        <h3>üåä Water Cycle (H‚ÇÇO)</h3>
        <div class="controls">
            <button class="material-btn" data-material="ice">Ice (-10¬∞C)</button>
            <button class="material-btn" data-material="water">Water (20¬∞C)</button>
            <button class="material-btn" data-material="steam">Steam (100¬∞C)</button>
        </div>
    </div>
    
    <div class="control-section">
        <h3>ü™® Earth & Minerals</h3>
        <div class="controls">
            <button class="material-btn active" data-material="sand">Sand (SiO‚ÇÇ)</button>
            <button class="material-btn" data-material="glass">Glass (1700¬∞C)</button>
            <button class="material-btn" data-material="stone">Stone</button>
            <button class="material-btn" data-material="lava">Lava (1200¬∞C)</button>
            <button class="material-btn" data-material="obsidian">Obsidian</button>
            <button class="material-btn" data-material="dirt">Dirt</button>
            <button class="material-btn" data-material="mud">Mud</button>
            <button class="material-btn" data-material="clay">Clay</button>
            <button class="material-btn" data-material="iron">Iron</button>
        </div>
    </div>
    
    <div class="control-section">
        <h3>üî• Flammable Materials</h3>
        <div class="controls">
            <button class="material-btn" data-material="wood">Wood (300¬∞C)</button>
            <button class="material-btn" data-material="coal">Coal (350¬∞C)</button>
            <button class="material-btn" data-material="oil">Oil (210¬∞C)</button>
            <button class="material-btn" data-material="gunpowder">Gunpowder (280¬∞C)</button>
            <button class="material-btn" data-material="fire">Fire (800¬∞C)</button>
        </div>
    </div>
    
    <div class="control-section">
        <h3>üí® Gases</h3>
        <div class="controls">
            <button class="material-btn" data-material="smoke">Smoke</button>
            <button class="material-btn" data-material="oxygen">Oxygen (O‚ÇÇ)</button>
            <button class="material-btn" data-material="hydrogen">Hydrogen (H‚ÇÇ)</button>
            <button class="material-btn" data-material="methane">Methane (CH‚ÇÑ)</button>
            <button class="material-btn" data-material="co2">CO‚ÇÇ</button>
        </div>
    </div>
    
    <div class="control-section">
        <h3>‚öóÔ∏è Reactive Materials</h3>
        <div class="controls">
            <button class="material-btn" data-material="acid">Acid (pH 1)</button>
            <button class="material-btn" data-material="salt">Salt (NaCl)</button>
            <button class="material-btn" data-material="sulfur">Sulfur (S)</button>
        </div>
    </div>
    
    <div class="controls">
        <div class="brush-size">
            <label>Brush:</label>
            <input type="range" id="brushSize" min="3" max="50" value="12">
            <span id="brushSizeValue">12</span>px
        </div>
    </div>
    
    <div class="controls">
        <button class="action-btn heat" id="soundBtn" onclick="toggleSound()">üîä Enable Sound</button>
        <div class="brush-size" id="volumeControl" style="display:none;">
            <label>Volume:</label>
            <input type="range" id="volumeSlider" min="0" max="100" value="70">
            <span id="volumeValue">70</span>%
        </div>
    </div>
    
    <div class="controls">
        <button class="action-btn heat" onclick="toggleHeat()">üå°Ô∏è Heat View (T)</button>
        <button class="action-btn heat" onclick="toggleLighting()">üåô Lighting (L)</button>
        <button class="action-btn" onclick="createExplosion()">üí• EXPLODE!</button>
        <button class="action-btn secondary" onclick="clearWorld()">üóëÔ∏è Clear All</button>
    </div>
    
    <div class="control-section">
        <h3>üí® Wind System (v3.5)</h3>
        <div class="controls">
            <div class="brush-size">
                <label>Wind X:</label>
                <input type="range" id="windX" min="-2" max="2" step="0.1" value="0">
                <span id="windXValue">0</span>
            </div>
            <div class="brush-size">
                <label>Wind Y:</label>
                <input type="range" id="windY" min="-2" max="2" step="0.1" value="0">
                <span id="windYValue">0</span>
            </div>
            <button class="action-btn secondary" onclick="resetWind()">Reset Wind</button>
        </div>
    </div>
    
    <div class="control-section">
        <h3>üíæ Save/Load (v3.5)</h3>
        <div class="controls">
            <button class="action-btn secondary" onclick="saveWorld()">üíæ Save World</button>
            <button class="action-btn secondary" onclick="loadWorld()">üìÇ Load World</button>
        </div>
    </div>
    
    <div class="control-section">
        <h3>üìã Scenarios</h3>
        <div class="controls">
            <button class="scenario-btn" onclick="loadScenario('volcano')">üåã Volcano</button>
            <button class="scenario-btn" onclick="loadScenario('lab')">üß™ Lab</button>
            <button class="scenario-btn" onclick="loadScenario('forest')">üî• Forest Fire</button>
            <button class="scenario-btn" onclick="loadScenario('underwater')">üåä Underwater</button>
            <button class="scenario-btn" onclick="loadScenario('arctic')">‚ùÑÔ∏è Arctic</button>
        </div>
    </div>
    
    <div class="info">
        <strong>v3.5: Performance Optimized + Entity Integration ‚ö°</strong><br>
        ‚Ä¢ <span class="temp">Cell-based lighting</span> ‚Äî NO canvas gradients! 40+ FPS on volcano scenario (was 15 FPS)<br>
        ‚Ä¢ <span class="temp">Entity-physics integration</span> ‚Äî getMaterialAt(), isSolidAt(), isDangerousAt(), disturbArea()<br>
        ‚Ä¢ <span class="temp">Wind system</span> ‚Äî affects fire, smoke, gases ‚Ä¢ Try setting wind and lighting fires!<br>
        ‚Ä¢ <span class="temp">Save/Load</span> ‚Äî save your creations and reload them anytime<br>
        ‚Ä¢ <span class="temp">Hot materials glow</span> ‚Äî materials above 400¬∞C blend toward white/yellow<br>
        ‚Ä¢ <span class="temp">Procedural sound</span> from material properties (click üîä to enable)<br>
        ‚Ä¢ Hover for temp ‚Ä¢ <strong>T</strong> = heat view ‚Ä¢ <strong>L</strong> = lighting ‚Ä¢ <strong>`</strong> = debug
    </div>
    
    <div class="stats">
        FPS: <span id="fps">60</span> ‚Ä¢ Materials: 25 ‚Ä¢ v3.5: Optimized Lighting ‚Ä¢ Wind: <span id="windStatus">(0, 0)</span> ‚Ä¢ Sound: <span id="soundStatus">Disabled</span>
    </div>

    <script src="bud.js"></script>
    <script>
        // Create engine
        const engine = new BudEngine({
            width: 800,
            height: 600,
            backgroundColor: '#0f0f1e'
        });

        // Initialize pixel physics
        engine.physics.init(engine.canvas.width, engine.canvas.height, 2);

        // Current selected material and brush size
        let selectedMaterial = 'sand';
        let brushSize = 12;
        let isMouseDown = false;
        let lastMouseX = 0;
        let lastMouseY = 0;

        // Material button selection
        document.querySelectorAll('.material-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.material-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedMaterial = btn.dataset.material;
            });
        });

        // Brush size slider
        const brushSizeSlider = document.getElementById('brushSize');
        const brushSizeValue = document.getElementById('brushSizeValue');
        brushSizeSlider.addEventListener('input', (e) => {
            brushSize = parseInt(e.target.value);
            brushSizeValue.textContent = brushSize;
        });

        // Temperature display on hover
        const tempDisplay = document.getElementById('tempDisplay');
        const tempValue = document.getElementById('tempValue');
        
        engine.canvas.addEventListener('mousemove', (e) => {
            const rect = engine.canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            const temp = engine.physics.getTemp(x, y);
            tempValue.textContent = Math.round(temp);
            
            if (!isMouseDown) {
                tempDisplay.classList.add('active');
            }
        });
        
        engine.canvas.addEventListener('mouseleave', () => {
            tempDisplay.classList.remove('active');
        });

        // Mouse interaction for placing materials
        engine.canvas.addEventListener('mousedown', (e) => {
            isMouseDown = true;
            tempDisplay.classList.remove('active');
            const rect = engine.canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            lastMouseX = x;
            lastMouseY = y;
            engine.physics.circle(x, y, brushSize, selectedMaterial);
        });

        engine.canvas.addEventListener('mousemove', (e) => {
            if (!isMouseDown) return;
            
            const rect = engine.canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Draw line from last position to current (for smooth drawing)
            const dx = x - lastMouseX;
            const dy = y - lastMouseY;
            const dist = Math.sqrt(dx * dx + dy * dy);
            const steps = Math.ceil(dist / (brushSize / 2));
            
            for (let i = 0; i <= steps; i++) {
                const t = i / steps;
                const px = lastMouseX + dx * t;
                const py = lastMouseY + dy * t;
                engine.physics.circle(px, py, brushSize, selectedMaterial);
            }
            
            lastMouseX = x;
            lastMouseY = y;
        });

        engine.canvas.addEventListener('mouseup', () => {
            isMouseDown = false;
        });

        engine.canvas.addEventListener('mouseleave', () => {
            isMouseDown = false;
        });

        // Touch support for mobile
        engine.canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = engine.canvas.getBoundingClientRect();
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;
            lastMouseX = x;
            lastMouseY = y;
            isMouseDown = true;
            engine.physics.circle(x, y, brushSize, selectedMaterial);
        });

        engine.canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (!isMouseDown) return;
            
            const touch = e.touches[0];
            const rect = engine.canvas.getBoundingClientRect();
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;
            
            const dx = x - lastMouseX;
            const dy = y - lastMouseY;
            const dist = Math.sqrt(dx * dx + dy * dy);
            const steps = Math.ceil(dist / (brushSize / 2));
            
            for (let i = 0; i <= steps; i++) {
                const t = i / steps;
                const px = lastMouseX + dx * t;
                const py = lastMouseY + dy * t;
                engine.physics.circle(px, py, brushSize, selectedMaterial);
            }
            
            lastMouseX = x;
            lastMouseY = y;
        });

        engine.canvas.addEventListener('touchend', () => {
            isMouseDown = false;
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 't' || e.key === 'T') {
                toggleHeat();
            }
            if (e.key === 'l' || e.key === 'L') {
                toggleLighting();
            }
        });

        // v3.3: Sound toggle
        function toggleSound() {
            const soundBtn = document.getElementById('soundBtn');
            const volumeControl = document.getElementById('volumeControl');
            const soundStatus = document.getElementById('soundStatus');
            const audioOverlay = document.getElementById('audioOverlay');
            
            if (!engine.physics.acoustics.enabled) {
                // Show overlay to get user interaction
                audioOverlay.style.display = 'flex';
                audioOverlay.onclick = () => {
                    audioOverlay.style.display = 'none';
                    const success = engine.physics.acoustics.init();
                    if (success) {
                        soundBtn.textContent = 'üîä Sound ON';
                        soundBtn.classList.add('active');
                        volumeControl.style.display = 'flex';
                        soundStatus.textContent = 'Enabled';
                        soundStatus.style.color = '#00ffcc';
                        console.log('üîä Acoustic Physics System enabled!');
                    } else {
                        soundBtn.textContent = 'üîá Sound Failed';
                        soundStatus.textContent = 'Failed';
                        soundStatus.style.color = '#ff0000';
                    }
                };
            } else {
                // Toggle off
                engine.physics.acoustics.enabled = false;
                soundBtn.textContent = 'üîá Sound OFF';
                soundBtn.classList.remove('active');
                volumeControl.style.display = 'none';
                soundStatus.textContent = 'Disabled';
                soundStatus.style.color = '#888';
            }
        }
        
        // Volume slider
        const volumeSlider = document.getElementById('volumeSlider');
        const volumeValue = document.getElementById('volumeValue');
        volumeSlider.addEventListener('input', (e) => {
            const volume = parseInt(e.target.value) / 100;
            volumeValue.textContent = e.target.value;
            engine.physics.acoustics.setVolume(volume);
        });
        
        // v3.5: Wind controls
        const windXSlider = document.getElementById('windX');
        const windXValue = document.getElementById('windXValue');
        const windYSlider = document.getElementById('windY');
        const windYValue = document.getElementById('windYValue');
        const windStatus = document.getElementById('windStatus');
        
        windXSlider.addEventListener('input', (e) => {
            const value = parseFloat(e.target.value);
            windXValue.textContent = value.toFixed(1);
            engine.physics.wind.x = value;
            updateWindStatus();
        });
        
        windYSlider.addEventListener('input', (e) => {
            const value = parseFloat(e.target.value);
            windYValue.textContent = value.toFixed(1);
            engine.physics.wind.y = value;
            updateWindStatus();
        });
        
        function updateWindStatus() {
            const wx = engine.physics.wind.x.toFixed(1);
            const wy = engine.physics.wind.y.toFixed(1);
            windStatus.textContent = `(${wx}, ${wy})`;
        }
        
        function resetWind() {
            engine.physics.wind.x = 0;
            engine.physics.wind.y = 0;
            windXSlider.value = 0;
            windYSlider.value = 0;
            windXValue.textContent = '0';
            windYValue.textContent = '0';
            updateWindStatus();
            console.log('üí® Wind reset');
        }
        
        // v3.5: Save/Load functions
        function saveWorld() {
            const saveData = engine.physics.save();
            if (saveData) {
                localStorage.setItem('pixelPhysics_world', JSON.stringify(saveData));
                console.log('üíæ World saved to localStorage');
                alert('World saved successfully!');
            }
        }
        
        function loadWorld() {
            const saveData = localStorage.getItem('pixelPhysics_world');
            if (saveData) {
                try {
                    engine.physics.load(JSON.parse(saveData));
                    console.log('üìÇ World loaded from localStorage');
                    alert('World loaded successfully!');
                    
                    // Update wind controls
                    windXSlider.value = engine.physics.wind.x;
                    windYSlider.value = engine.physics.wind.y;
                    windXValue.textContent = engine.physics.wind.x.toFixed(1);
                    windYValue.textContent = engine.physics.wind.y.toFixed(1);
                    updateWindStatus();
                } catch (e) {
                    console.error('Failed to load world:', e);
                    alert('Failed to load world!');
                }
            } else {
                alert('No saved world found!');
            }
        }
        
        // Heat visualization toggle
        function toggleHeat() {
            engine.physics.toggleHeatView();
        }
        
        // v3.5: Dynamic lighting toggle
        function toggleLighting() {
            engine.physics.toggleLighting();
        }

        // Explosion function
        function createExplosion() {
            const x = engine.canvas.width / 2 + (Math.random() - 0.5) * 200;
            const y = engine.canvas.height / 2 + (Math.random() - 0.5) * 200;
            engine.physics.explode(x, y, 70, 200);
            engine.cameraShake(10);
        }

        // Clear world function
        function clearWorld() {
            engine.physics.clearArea(0, 0, engine.canvas.width, engine.canvas.height);
            buildInitialWorld();
        }

        // Load scenario
        function loadScenario(name) {
            clearWorld();
            
            if (name === 'volcano') {
                // Lava chamber
                engine.physics.fill(300, 400, 500, 500, 'lava');
                // Stone walls
                engine.physics.fill(200, 300, 280, 550, 'stone');
                engine.physics.fill(520, 300, 600, 550, 'stone');
                // Water pool on one side
                engine.physics.fill(50, 450, 150, 550, 'water');
                // Wooden platforms
                engine.physics.fill(150, 350, 200, 370, 'wood');
                
                console.log('üåã Volcano: Watch lava heat the environment. Pour water on it!');
            } else if (name === 'lab') {
                // Test tubes
                engine.physics.fill(150, 450, 170, 550, 'glass');
                engine.physics.fill(150, 480, 170, 530, 'acid');
                
                engine.physics.fill(250, 450, 270, 550, 'glass');
                engine.physics.fill(250, 480, 270, 530, 'water');
                
                engine.physics.fill(350, 450, 370, 550, 'glass');
                engine.physics.fill(350, 480, 370, 530, 'hydrogen');
                
                engine.physics.fill(450, 450, 470, 550, 'glass');
                engine.physics.fill(450, 480, 470, 530, 'oxygen');
                
                // Metal samples
                engine.physics.fill(600, 480, 640, 500, 'iron');
                
                // Flammable materials
                engine.physics.fill(100, 300, 130, 330, 'oil');
                engine.physics.fill(200, 300, 230, 330, 'gunpowder');
                
                console.log('üß™ Lab: Drop acid on metal. Mix hydrogen + oxygen, then ignite!');
            } else if (name === 'forest') {
                // Trees (wood)
                for (let i = 0; i < 8; i++) {
                    const x = 100 + i * 90;
                    engine.physics.fill(x, 350, x + 40, 550, 'wood');
                }
                // Ground
                engine.physics.fill(0, 550, 800, 600, 'dirt');
                // Some coal deposits
                engine.physics.fill(300, 520, 340, 550, 'coal');
                // Starting fire
                engine.physics.circle(100, 400, 15, 'fire');
                
                console.log('üî• Forest Fire: Watch fire spread, heat neighbors, and consume oxygen');
            } else if (name === 'underwater') {
                // Water
                engine.physics.fill(0, 100, 800, 600, 'water');
                // Sand bottom
                engine.physics.fill(0, 550, 800, 600, 'sand');
                // Underwater volcano
                engine.physics.fill(350, 500, 450, 550, 'stone');
                engine.physics.circle(400, 520, 30, 'lava');
                
                console.log('üåä Underwater: Lava + Water = Steam! Watch it rise');
            } else if (name === 'arctic') {
                // Ice shelf
                engine.physics.fill(0, 300, 800, 400, 'ice');
                // Water below
                engine.physics.fill(0, 400, 800, 600, 'water');
                // Some lava to melt it
                engine.physics.circle(400, 350, 40, 'lava');
                
                console.log('‚ùÑÔ∏è Arctic: Watch ice melt into water, then boil into steam');
            }
        }

        // Build some initial structures
        function buildInitialWorld() {
            // Bottom stone floor
            engine.physics.fill(0, 560, 800, 600, 'stone');
            
            // Stone walls on sides
            engine.physics.fill(0, 0, 25, 600, 'stone');
            engine.physics.fill(775, 0, 800, 600, 'stone');
            
            // Some wooden platforms
            engine.physics.fill(100, 480, 280, 495, 'wood');
            engine.physics.fill(520, 400, 700, 415, 'wood');
            engine.physics.fill(200, 300, 380, 315, 'wood');
            
            // Stone pillars
            engine.physics.fill(150, 420, 175, 480, 'stone');
            engine.physics.fill(625, 330, 650, 400, 'stone');
        }

        // Initialize world
        buildInitialWorld();

        // Main scene
        engine.scene('main', {
            enter() {
                console.log('[PixelPhysics v3.5] Performance Optimized + Entity Integration');
                console.log('‚Ä¢ Cell-based lighting: 40+ FPS (was 15 FPS)');
                console.log('‚Ä¢ Entity-physics integration: getMaterialAt(), isSolidAt(), isDangerousAt(), disturbArea()');
                console.log('‚Ä¢ Wind system: affects fire, smoke, gases');
                console.log('‚Ä¢ Save/Load worlds');
                console.log('‚Ä¢ Hot materials glow (>400¬∞C)');
                console.log('‚Ä¢ Press T for heat view, L for lighting toggle');
            },
            
            update(dt) {
                // Update FPS display
                document.getElementById('fps').textContent = engine.fps;
            }
        });

        // Start engine
        engine.goTo('main');
        engine.start();

        console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
        console.log('‚ö° PIXEL PHYSICS v3.5 - Performance Optimized + Entity Integration');
        console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
        console.log('NEW IN v3.5:');
        console.log('  ‚ö° Cell-based lighting: 40+ FPS on volcano (was 15 FPS!)');
        console.log('  üéÆ Entity-physics integration API:');
        console.log('     ‚Ä¢ engine.physics.getMaterialAt(x, y)');
        console.log('     ‚Ä¢ engine.physics.isSolidAt(x, y)');
        console.log('     ‚Ä¢ engine.physics.isLiquidAt(x, y)');
        console.log('     ‚Ä¢ engine.physics.isDangerousAt(x, y)');
        console.log('     ‚Ä¢ engine.physics.disturbArea(x, y, radius, force)');
        console.log('  üí® Wind system: affects fire, smoke, gases');
        console.log('     ‚Ä¢ Set wind.x and wind.y with sliders');
        console.log('     ‚Ä¢ Fire flickers in wind direction');
        console.log('  üíæ Save/Load: save your creations!');
        console.log('  ‚ú® Hot materials glow: >400¬∞C blend toward white/yellow');
        console.log('');
        console.log('üî¨ TRY THESE EXPERIMENTS:');
        console.log('  ‚Ä¢ Load "Volcano" ‚Äî watch FPS stay at 40+ (was 15!)');
        console.log('  ‚Ä¢ Set wind ‚Üí light a fire ‚Üí watch it blow sideways');
        console.log('  ‚Ä¢ Create something cool ‚Üí click Save ‚Üí Clear ‚Üí Load it back');
        console.log('  ‚Ä¢ Pour lava ‚Üí watch it glow brighter as it heats up');
        console.log('  ‚Ä¢ Click üîä Enable Sound to hear the physics!');
        console.log('');
        console.log('T = heat view ‚Ä¢ L = lighting ‚Ä¢ Wind sliders ‚Ä¢ Save/Load buttons');
        console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
    </script>
</body>
</html>
